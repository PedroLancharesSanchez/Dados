<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Juego de Dados</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      height: 100vh;
      background: white;
      display: flex;
      flex-direction: column;
      justify-content: center; /* Centra vertical */
      align-items: center;     /* Centra horizontal */
      overflow-x: hidden;
      position: relative;
      padding: 0;
    }

    h1 {
      margin-bottom: 40px;
      font-size: 6em; /* el doble de 3em */
      text-align: center;
    }

    .player-select,
    .controls {
      display: flex;
      flex-direction: column;
      gap: 40px; /* el doble */
      align-items: center;
      justify-content: center;
      margin-bottom: 60px;
      position: relative;
      z-index: 20;
    }

    button {
      padding: 40px 80px; /* doble */
      font-size: 4.4em; /* doble */
      cursor: pointer;
      border-radius: 20px;
      border: 2px solid #333;
      background-color: white;
      transition: background 0.2s ease;
    }

    button:hover {
      background: #ddd;
    }

    .score {
      position: absolute;
      background: white;
      padding: 20px 40px; /* doble */
      border: 2px solid black;
      border-radius: 20px;
      min-width: 280px; /* doble */
      text-align: center;
      font-weight: bold;
      font-size: 4em; /* doble */
      z-index: 10;
      box-sizing: border-box;
    }

    /* Mantener puntuaciones en esquinas, con algo mÃ¡s de margen para que no queden pegadas */
    .p1 { top: 20px; left: 20px; }
    .p2 { top: 20px; right: 20px; }
    .p3 { bottom: 20px; left: 20px; }
    .p4 { bottom: 20px; right: 20px; }

    .dice-container {
      display: flex;
      flex-wrap: wrap;
      gap: 30px; /* doble */
      justify-content: center;
      margin: 40px 0; /* doble */
      position: relative;
      height: 200px; /* doble */
      width: 1200px; /* doble */
      z-index: 15;
    }

    .dice {
      width: 160px; /* doble */
      height: 160px; /* doble */
      object-fit: contain;
      border-radius: 20px;
      position: absolute;
      top: 0;
      left: 0;
      transition: box-shadow 0.3s ease;
    }

    #turno-actual {
      font-weight: bold;
      font-size: 5em; /* doble */
      margin-bottom: 20px;
      z-index: 20;
      text-align: center;
      width: 100%;
    }

    #puntos-turno {
      margin-top: 30px; /* doble */
      font-style: italic;
      font-size: 4em; /* doble */
      text-align: center;
      z-index: 20;
      width: 100%;
    }

    #resultados-tiradas {
      margin-top: 40px; /* doble */
      display: flex;
      gap: 30px; /* doble */
      min-height: 200px; /* doble */
      width: 1200px; /* doble */
      flex-wrap: wrap;
      justify-content: center;
      border: 2px solid #333;
      padding: 20px; /* doble */
      border-radius: 20px;
      background: #fafafa;
      position: relative;
      z-index: 10;
      box-sizing: border-box;
    }

    .dice-result {
      width: 120px !important; /* doble 60px */
      height: 120px !important;
      position: relative !important;
      top: auto !important;
      left: auto !important;
      box-shadow: 0 0 20px 8px green;
      border-radius: 20px;
      margin: 0 10px; /* doble */
      transition: box-shadow 0.3s ease;
    }

    .color1 { box-shadow: 0 0 30px 8px #4CAF50 !important; }
    .color2 { box-shadow: 0 0 30px 8px #2196F3 !important; }
    .color3 { box-shadow: 0 0 30px 8px #FF9800 !important; }
    .color4 { box-shadow: 0 0 30px 8px #9C27B0 !important; }
    .color5 { box-shadow: 0 0 30px 8px #E91E63 !important; }
    .color6 { box-shadow: 0 0 30px 8px #00BCD4 !important; }

    .resaltado-actual {
      box-shadow: 0 0 30px 8px #4CAF50 !important;
    }

    .resaltado-previo {
      box-shadow: 0 0 30px 8px #2196F3 !important;
    }
  </style>
</head>
<body>

  <h1>Selecciona nÃºmero de jugadores</h1>
  <div class="player-select">
    <button onclick="selectPlayers(2)">2 Jugadores</button>
    <button onclick="selectPlayers(3)">3 Jugadores</button>
    <button onclick="selectPlayers(4)">4 Jugadores</button>
  </div>

  <div id="turno-actual"></div>

  <div class="dice-container" id="dados"></div>

  <div class="controls" style="display:none;">
    <button onclick="lanzarDados()">ðŸŽ² Lanzar Dados</button>
    <button onclick="plantarse()">âœ‹ Plantarse</button>
  </div>

  <div id="puntos-turno"></div>

  <div id="resultados-tiradas"></div>

<script>
  let jugadores = 0;
  let puntuaciones = [];
  let turno = 0;
  let puntosTurno = 0;
  let dadosRestantes = 6;

  let tiradaNumero = 0;
  let coloresTiradas = ["color1","color2","color3","color4","color5","color6"];

  let dadosResaltadosPrevios = [];

  function selectPlayers(count) {
    jugadores = count;
    puntuaciones = Array(count).fill(0);

    document.querySelector("h1").style.display = "none";
    document.querySelector(".player-select").style.display = "none";

    const posiciones = ["p1", "p2", "p3", "p4"];
    for (let i = 0; i < count; i++) {
      const marcador = document.createElement("div");
      marcador.className = `score ${posiciones[i]}`;
      marcador.id = `jugador${i}`;
      marcador.textContent = `Jugador ${i + 1}: 0`;
      document.body.appendChild(marcador);
    }

    document.querySelector(".controls").style.display = "flex";
    mostrarTurno();
  }

  function mostrarTurno() {
    document.getElementById("turno-actual").textContent = `Turno de Jugador ${turno + 1}`;
  }

  function mostrarDados(valores) {
    const contenedor = document.getElementById("dados");
    contenedor.innerHTML = "";

    valores.forEach((valor, idx) => {
      const dadoWrapper = document.createElement("div");
      dadoWrapper.style.position = "relative";
      dadoWrapper.style.width = "160px"; // doble
      dadoWrapper.style.height = "160px"; // doble

      dadoWrapper.style.position = "absolute";
      dadoWrapper.style.left = `${idx * 180}px`; // doble distancia + 10 extra para separaciÃ³n
      dadoWrapper.style.top = `0`;

      const img = document.createElement("img");
      img.src = `img/dice${valor}.png`;
      img.alt = `Dado ${valor}`;
      img.className = "dice";

      dadoWrapper.appendChild(img);
      contenedor.appendChild(dadoWrapper);
    });
  }

  function animarDado(dadoWrapper, callback) {
    const video = document.createElement("video");
    video.src = "video/lanzar.mp4";
    video.muted = true;

    // Ajustamos tamaÃ±o del video para cubrir exactamente 160x160px dado
    video.style.position = "absolute";
    video.style.top = "0";
    video.style.left = "0";
    video.style.width = "160px";
    video.style.height = "160px";
    video.style.zIndex = "10";

    // Quitamos clipPath para que no se vea nada del dado debajo
    // (antes recortaba 10px a cada lado, ahora queremos que cubra completo)
    video.style.clipPath = "none";

    dadoWrapper.appendChild(video);

    const sonido = new Audio("sounds/lanzar-dados.mp3");

    sonido.addEventListener("loadedmetadata", () => {
      if (video.readyState >= 2) {
        ajustarDuracion();
      } else {
        video.addEventListener("loadedmetadata", ajustarDuracion);
      }

      function ajustarDuracion() {
        const nuevaDuracion = sonido.duration - 2.3;
        video.playbackRate = video.duration / nuevaDuracion;
        video.play().catch(() => {});
        sonido.play().catch(() => {});
      }
    });

    video.onended = () => {
      dadoWrapper.removeChild(video);
      if (typeof callback === "function") callback();
    };
  }

  function lanzarDados() {
    if (dadosRestantes <= 0) {
      alert("No quedan dados para lanzar. Plantate o reinicia el turno.");
      return;
    }
    const cantidad = dadosRestantes;
    const dados = Array.from({ length: cantidad }, () => Math.floor(Math.random() * 6) + 1);

    const contenedor = document.getElementById("dados");
    contenedor.style.display = "block";
    mostrarDados(dados);

    let animacionesPendientes = cantidad;

    for (let i = 0; i < cantidad; i++) {
      const dadoWrapper = contenedor.children[i];
      animarDado(dadoWrapper, () => {
        animacionesPendientes--;
        if (animacionesPendientes === 0) {
          setTimeout(() => {
            procesarPuntos(dados);
            moverDadosPuntuados(dados);
          }, 1000);
        }
      });
    }
  }

  function procesarPuntos(dados) {
    const { puntos, dadosUtiles } = calcularPuntos(dados);
    if (puntos === 0) {
      alert("Â¡Sin puntos! Turno perdido.");
      puntosTurno = 0;
      pasarTurno();
    } else {
      puntosTurno += puntos;
      dadosRestantes = dados.length - dadosUtiles;
      if (dadosRestantes === 0) dadosRestantes = 6;
      document.getElementById("puntos-turno").textContent = `Puntos este turno: ${puntosTurno}`;
    }
  }

  function calcularPuntos(dados) {
    let contador = [0,0,0,0,0,0,0];
    dados.forEach(d => contador[d]++);
    let puntos = 0;
    let dadosUtiles = 0;

    if (contador.slice(1).every(c => c === 1)) {
      puntos += 1500;
      dadosUtiles = 6;
      return { puntos, dadosUtiles };
    }

    for (let i = 1; i <= 6; i++) {
      if (contador[i] >= 3) {
        if (i === 1) {
          puntos += (contador[i] === 3) ? 1000 : 1000 * 2**(contador[i]-3);
        } else {
          puntos += i * 100 * 2**(contador[i]-3);
        }
        dadosUtiles += contador[i];
        contador[i] = 0;
      }
    }

    if (contador[1] > 0) {
      puntos += contador[1] * 100;
      dadosUtiles += contador[1];
    }
    if (contador[5] > 0) {
      puntos += contador[5] * 50;
      dadosUtiles += contador[5];
    }

    return { puntos, dadosUtiles };
  }

  function moverDadosPuntuados(dados) {
    const resultados = document.getElementById("resultados-tiradas");

    tiradaNumero = (tiradaNumero + 1) % coloresTiradas.length;
    const claseColor = coloresTiradas[tiradaNumero];

    dadosResaltadosPrevios.forEach(img => {
      img.classList.remove("resaltado-actual");
      img.classList.add("resaltado-previo");
    });
    dadosResaltadosPrevios = [];

    let { dadosUtiles } = calcularPuntos(dados);
    if (dadosUtiles === 0) return;

    const dadosPuntuados = dados.slice(0, dadosUtiles);

    const contenedorDados = document.getElementById("dados");

    dadosPuntuados.forEach((valor, idx) => {
      const dadoOriginal = contenedorDados.children[idx].querySelector("img");
      const rectOriginal = dadoOriginal.getBoundingClientRect();

      const clone = dadoOriginal.cloneNode();
      clone.classList.add("dice-result", "resaltado-actual", claseColor);

      clone.style.position = "fixed";
      clone.style.top = `${rectOriginal.top}px`;
      clone.style.left = `${rectOriginal.left}px`;
      clone.style.margin = "0";

      document.body.appendChild(clone);

      setTimeout(() => {
        resultados.appendChild(clone);
        clone.style.position = "relative";
        clone.style.top = "auto";
        clone.style.left = "auto";
        clone.style.margin = "0 10px";
      }, 100);

      dadosResaltadosPrevios.push(clone);
    });
  }

  function plantarse() {
    puntuaciones[turno] += puntosTurno;
    document.getElementById(`jugador${turno}`).textContent = `Jugador ${turno + 1}: ${puntuaciones[turno]}`;
    puntosTurno = 0;
    dadosRestantes = 6;

    document.getElementById("puntos-turno").textContent = "";

    pasarTurno();
  }

  function pasarTurno() {
    turno = (turno + 1) % jugadores;
    mostrarTurno();
    document.getElementById("dados").innerHTML = "";
    document.getElementById("puntos-turno").textContent = "";
  }
</script>

</body>
</html>
