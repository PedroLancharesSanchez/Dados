<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Juego de Dados Animado</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #222;
      color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
      margin: 0;
    }

    h1 {
      margin-bottom: 10px;
    }

    #mensaje {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: #aaffaa;
      padding: 10px 20px;
      border-radius: 8px;
      opacity: 0;
      pointer-events: none;
      font-weight: bold;
      user-select: none;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }

    .aparecerDesaparecer {
      animation: aparecerDesaparecer 2.5s forwards;
    }
    @keyframes aparecerDesaparecer {
      0% {opacity: 0;}
      10% {opacity: 1;}
      90% {opacity: 1;}
      100% {opacity: 0;}
    }

    .container-juego {
      display: flex;
      justify-content: center;
      gap: 40px;
      width: 100%;
      max-width: 900px;
    }

    .player {
      background: #333;
      padding: 15px;
      border-radius: 12px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 0 10px #0a0;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      transition: box-shadow 0.3s ease;
    }

    .player.turn {
      box-shadow: 0 0 20px #0f0;
    }

    .player h2 {
      margin: 0 0 10px;
    }

    .puntaje {
      font-size: 1.2em;
      margin-bottom: 8px;
      user-select: none;
    }

    #turnCount {
      font-size: 1.2em;
      margin-bottom: 20px;
      user-select: none;
    }

    .dice-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 6px;
      min-height: 70px;
      margin-bottom: 10px;
      cursor: pointer;
    }

    .dice-container img {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      user-select: none;
      transition: transform 0.3s ease;
      filter: drop-shadow(0 0 2px #000);
    }
    .dice-container img.usado {
      filter: drop-shadow(0 0 6px #0f0);
      transform: scale(1.1);
      cursor: default;
      opacity: 0.7;
    }
    .dice-container img.no-usado:hover {
      transform: scale(1.2);
      filter: drop-shadow(0 0 10px #0f0);
    }

    .destello-verde {
      animation: destello 2s ease-in-out;
    }
    @keyframes destello {
      0%, 100% { filter: drop-shadow(0 0 6px #0f0); }
      50% { filter: drop-shadow(0 0 20px #0f0); }
    }

    button {
      padding: 8px 14px;
      margin: 5px;
      font-size: 1em;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background: #0a0;
      color: #fff;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:disabled {
      background: #555;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      background: #0f0;
      color: #000;
    }

    .dados-puntuados {
      display: flex;
      min-height: 70px;
      margin-top: 10px;
      gap: 6px;
      justify-content: center;
    }

    /* Animaci√≥n fade-in para dados puntuados */
    .dados-puntuados img {
      opacity: 0;
      animation: fadeIn 1s forwards;
      width: 60px;
      height: 60px;
      border-radius: 8px;
      filter: drop-shadow(0 0 6px #0f0);
    }

    @keyframes fadeIn {
      to {opacity: 1;}
    }
  </style>
</head>
<body>

  <h1>Juego de Dados Animado</h1>
  <div id="mensaje"></div>

  <div id="turnCount">Turno: 1</div>

  <div class="container-juego">
    <section id="player1" class="player turn">
      <h2>Jugador 1</h2>
      <div id="total1" class="puntaje">Total: 0</div>
      <div id="score1" class="puntaje">Turno: 0</div>
      <div id="restantes1" class="puntaje">Dados restantes: 6</div>
      <div id="dice1" class="dice-container"></div>
      <button onclick="tirar(1)">Tirar</button>
      <button onclick="plantarse(1)">Plantarse</button>
      <div id="dadosPuntuados1" class="dados-puntuados"></div>
    </section>

    <section id="player2" class="player">
      <h2>Jugador 2</h2>
      <div id="total2" class="puntaje">Total: 0</div>
      <div id="score2" class="puntaje">Turno: 0</div>
      <div id="restantes2" class="puntaje">Dados restantes: 6</div>
      <div id="dice2" class="dice-container"></div>
      <button onclick="tirar(2)">Tirar</button>
      <button onclick="plantarse(2)">Plantarse</button>
      <div id="dadosPuntuados2" class="dados-puntuados"></div>
    </section>
  </div>

  <!-- Sonidos (puedes poner tus propios archivos o quitarlos) -->
  <audio id="sound-roll" src="https://actions.google.com/sounds/v1/dice/rolling_dice.ogg"></audio>
  <audio id="sound-win" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
  <audio id="sound-turn" src="https://actions.google.com/sounds/v1/cartoon/slide_whistle_to_drum_hit.ogg"></audio>
  <audio id="sound-fail" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"></audio>

  <script>
    (() => {
      const maxDados = 6;
      let turno = 1;
      let jugadorActivo = 1;
      let puntajesTotales = { 1: 0, 2: 0 };
      let puntajeTurno = { 1: 0, 2: 0 };
      let dadosRestantes = { 1: maxDados, 2: maxDados };
      let dadosUsados = { 1: [], 2: [] };
      let tiradaActual = { 1: [], 2: [] };
      let tiradasPuntuadas = { 1: [], 2: [] };

      const diceImgs = {
        1: "https://upload.wikimedia.org/wikipedia/commons/1/1b/Dice-1-b.svg",
        2: "https://upload.wikimedia.org/wikipedia/commons/5/5f/Dice-2-b.svg",
        3: "https://upload.wikimedia.org/wikipedia/commons/b/b1/Dice-3-b.svg",
        4: "https://upload.wikimedia.org/wikipedia/commons/f/fd/Dice-4-b.svg",
        5: "https://upload.wikimedia.org/wikipedia/commons/0/08/Dice-5-b.svg",
        6: "https://upload.wikimedia.org/wikipedia/commons/2/26/Dice-6-b.svg",
      };

      const soundRoll = document.getElementById("sound-roll");
      const soundWin = document.getElementById("sound-win");
      const soundTurn = document.getElementById("sound-turn");
      const soundFail = document.getElementById("sound-fail");
      const mensajeDiv = document.getElementById("mensaje");

      function mostrarMensaje(texto) {
        mensajeDiv.textContent = texto;
        mensajeDiv.style.opacity = 1;
        mensajeDiv.style.pointerEvents = "auto";
        mensajeDiv.classList.remove("aparecerDesaparecer");
        void mensajeDiv.offsetWidth; // trigger reflow
        mensajeDiv.classList.add("aparecerDesaparecer");

        setTimeout(() => {
          mensajeDiv.style.opacity = 0;
          mensajeDiv.style.pointerEvents = "none";
        }, 2500);
      }

      function cambiarTurno() {
        jugadorActivo = jugadorActivo === 1 ? 2 : 1;
        turno++;
        document.getElementById("turnCount").textContent = "Turno: " + turno;

        [1, 2].forEach(j => {
          const playerDiv = document.getElementById("player" + j);
          if (j === jugadorActivo) {
            playerDiv.classList.add("turn");
            setTimeout(() => {
              const dados = playerDiv.querySelectorAll(".dice-container img.usado");
              dados.forEach(dado => {
                dado.classList.add("destello-verde");
                setTimeout(() => dado.classList.remove("destello-verde"), 2000);
              });
            }, 100);
          } else {
            playerDiv.classList.remove("turn");
          }
        });

        puntajeTurno[jugadorActivo] = 0;
        dadosRestantes[jugadorActivo] = maxDados;
        dadosUsados[jugadorActivo] = [];
        tiradaActual[jugadorActivo] = [];
        actualizarInterfaz(jugadorActivo);
        deshabilitarBotones();
        habilitarBotones();
      }

      function actualizarInterfaz(jugador) {
        document.getElementById("total" + jugador).textContent = "Total: " + puntajesTotales[jugador];
        document.getElementById("score" + jugador).textContent = "Turno: " + puntajeTurno[jugador];
        document.getElementById("restantes" + jugador).textContent = "Dados restantes: " + dadosRestantes[jugador];
      }

      function crearDado(valor, usado = false) {
        const img = document.createElement("img");
        img.src = diceImgs[valor];
        if (usado) img.classList.add("usado");
        else img.classList.add("no-usado");
        return img;
      }

      function tirarDados(cantidad) {
        let resultados = [];
        for (let i = 0; i < cantidad; i++) {
          resultados.push(Math.floor(Math.random() * 6) + 1);
        }
        return resultados;
      }

      function animarDados(dadosImgs) {
        dadosImgs.forEach((img, i) => {
          img.style.opacity = 0;
          img.style.transform = "translateY(-20px)";
          setTimeout(() => {
            img.style.transition = "opacity 0.3s ease, transform 0.3s ease";
            img.style.opacity = 1;
            img.style.transform = "translateY(0)";
          }, i * 100);
        });
      }

      window.tirar = function(jugador) {
        if (jugador !== jugadorActivo) return;

        if (dadosRestantes[jugador] === 0) {
          mostrarMensaje("No tienes dados restantes, debes plantarte");
          if (soundFail) {
            soundFail.currentTime = 0;
            soundFail.play();
          }
          return;
        }

        if (soundRoll) {
          soundRoll.currentTime = 0;
          soundRoll.play();
        }

        const resultados = tirarDados(dadosRestantes[jugador]);
        tiradaActual[jugador] = resultados;

        const diceContainer = document.getElementById("dice" + jugador);
        diceContainer.innerHTML = "";

        resultados.forEach((valor) => {
          const dadoImg = crearDado(valor, false);
          diceContainer.appendChild(dadoImg);
        });

        animarDados([...diceContainer.children]);

        habilitarBotones();
      };

      window.seleccionarDado = function(jugador, dadoImg, valor) {
        if (jugador !== jugadorActivo) return;

        if (dadoImg.classList.contains("usado")) return;

        if (dadoImg.classList.contains("no-usado")) {
          dadoImg.classList.remove("no-usado");
          dadoImg.classList.add("usado");
          dadosUsados[jugador].push(valor);

          puntajeTurno[jugador] += valor;
          dadosRestantes[jugador]--;

          actualizarInterfaz(jugador);
        }
      };

      window.plantarse = function(jugador) {
        if (jugador !== jugadorActivo) return;

        puntajesTotales[jugador] += puntajeTurno[jugador];
        tiradasPuntuadas[jugador].push([...dadosUsados[jugador]]);
        dadosUsados[jugador] = [];
        tiradaActual[jugador] = [];

        actualizarInterfaz(jugador);

        if (soundTurn) {
          soundTurn.currentTime = 0;
          soundTurn.play();
        }

        animarDadosPuntuados(jugador);

        if (puntajesTotales[jugador] >= 100) {
          mostrarMensaje(`¬°Jugador ${jugador} gana! üéâ`);
          if (soundWin) {
            soundWin.currentTime = 0;
            soundWin.play();
          }
          deshabilitarBotones();
          return;
        }

        cambiarTurno();
      };

      function animarDadosPuntuados(jugador) {
        const dadosContainer = document.getElementById("dice" + jugador);
        const dadosPuntuadosContainer = document.getElementById("dadosPuntuados" + jugador);
        const dadosImgs = [...dadosContainer.querySelectorAll("img.usado")];

        dadosImgs.forEach(dadoImg => {
          const rectInicial = dadoImg.getBoundingClientRect();
          const clon = dadoImg.cloneNode(true);
          document.body.appendChild(clon);
          clon.style.position = "fixed";
          clon.style.left = rectInicial.left + "px";
          clon.style.top = rectInicial.top + "px";
          clon.style.margin = 0;
          clon.style.zIndex = 1000;
          clon.style.transition = "all 1.2s ease-in-out";

          const destinoRect = dadosPuntuadosContainer.getBoundingClientRect();
          const offsetX = destinoRect.left + dadosPuntuadosContainer.children.length * 70 + 10;
          const offsetY = destinoRect.top + 5;

          clon.getBoundingClientRect();

          clon.style.left = offsetX + "px";
          clon.style.top = offsetY + "px";
          clon.style.width = "60px";
          clon.style.height = "60px";

          setTimeout(() => {
            dadosPuntuadosContainer.appendChild(clon);
            clon.style.position = "";
            clon.style.left = "";
            clon.style.top = "";
            clon.style.margin = "0 6px 0 0";
            clon.style.zIndex = "";
            clon.style.transition = "";
          }, 1200);
        });

        setTimeout(() => {
          document.getElementById("dice" + jugador).innerHTML = "";
          dadosRestantes[jugador] = maxDados;
          puntajeTurno[jugador] = 0;
          actualizarInterfaz(jugador);
        }, 1300);
      }

      function deshabilitarBotones() {
        [1, 2].forEach(j => {
          const playerDiv = document.getElementById("player" + j);
          playerDiv.querySelectorAll("button").forEach(b => b.disabled = true);
        });
      }

      function habilitarBotones() {
        [1, 2].forEach(j => {
          const playerDiv = document.getElementById("player" + j);
          if (j === jugadorActivo) {
            playerDiv.querySelectorAll("button").forEach(b => b.disabled = false);
          } else {
            playerDiv.querySelectorAll("button").forEach(b => b.disabled = true);
          }
        });
      }

      function agregarEventosDados(jugador) {
        const diceContainer = document.getElementById("dice" + jugador);
        diceContainer.addEventListener("click", e => {
          if (e.target.tagName === "IMG" && jugador === jugadorActivo) {
            const src = e.target.src;
            const valor = Object.keys(diceImgs).find(key => diceImgs[key] === src);
            if (!valor) return;
            seleccionarDado(jugador, e.target, parseInt(valor));
          }
        });
      }

      function iniciarJuego() {
        [1, 2].forEach(j => {
          agregarEventosDados(j);
          actualizarInterfaz(j);
        });
        cambiarTurno();
      }

      window.onload = iniciarJuego;
    })();
  </script>
</body>
</html>
