<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Juego de Dados</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
      background: white;  /* Fondo blanco */
      padding-top: 20px;
      position: relative;
      overflow-x: hidden;
    }

    h1 {
      margin-bottom: 20px;
      font-size: 3em;
      text-align: center;
    }

    .player-select,
    .controls {
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: center;
      justify-content: center;
      margin-bottom: 30px;
    }

    button {
      padding: 20px 40px;
      font-size: 2.2em;
      cursor: pointer;
      border-radius: 10px;
      border: 2px solid #333;
      background-color: white;
      transition: background 0.2s ease;
    }

    button:hover {
      background: #ddd;
    }

    .score {
      position: absolute;
      background: white;
      padding: 10px 20px;
      border: 2px solid black;
      border-radius: 10px;
      min-width: 140px;
      text-align: center;
      font-weight: bold;
      font-size: 2em;
    }

    .p1 { top: 10px; left: 10px; }
    .p2 { top: 10px; right: 10px; }
    .p3 { bottom: 10px; left: 10px; }
    .p4 { bottom: 10px; right: 10px; }

    .dice-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      margin: 20px 0;
    }

    .dice {
      width: 80px;
      height: 80px;
      object-fit: contain;
      border-radius: 10px;
      position: absolute;
      top: 0;
      left: 0;
    }

    #turno-actual {
      font-weight: bold;
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    #puntos-turno {
      margin-top: 15px;
      font-style: italic;
      font-size: 2em;
      text-align: center;
    }

  </style>
</head>
<body>

  <h1>Selecciona nÃºmero de jugadores</h1>
  <div class="player-select">
    <button onclick="selectPlayers(2)">2 Jugadores</button>
    <button onclick="selectPlayers(3)">3 Jugadores</button>
    <button onclick="selectPlayers(4)">4 Jugadores</button>
  </div>

  <div id="turno-actual"></div>

  <div class="dice-container" id="dados"></div>

  <div class="controls" style="display:none;">
    <button onclick="lanzarDados()">ðŸŽ² Lanzar Dados</button>
    <button onclick="plantarse()">âœ‹ Plantarse</button>
  </div>

  <div id="puntos-turno"></div>

<script>
  let jugadores = 0;
  let puntuaciones = [];
  let turno = 0;
  let puntosTurno = 0;
  let dadosRestantes = 6;

  function selectPlayers(count) {
    jugadores = count;
    puntuaciones = Array(count).fill(0);

    document.querySelector("h1").style.display = "none";
    document.querySelector(".player-select").style.display = "none";

    const posiciones = ["p1", "p2", "p3", "p4"];
    for (let i = 0; i < count; i++) {
      const marcador = document.createElement("div");
      marcador.className = `score ${posiciones[i]}`;
      marcador.id = `jugador${i}`;
      marcador.textContent = `Jugador ${i + 1}: 0`;
      document.body.appendChild(marcador);
    }

    document.querySelector(".controls").style.display = "flex";
    mostrarTurno();
  }

  function mostrarTurno() {
    document.getElementById("turno-actual").textContent = `Turno de Jugador ${turno + 1}`;
  }

  function mostrarDados(valores) {
    const contenedor = document.getElementById("dados");
    contenedor.innerHTML = "";

    valores.forEach((valor) => {
      const dadoWrapper = document.createElement("div");
      dadoWrapper.style.position = "relative";
      dadoWrapper.style.width = "80px";
      dadoWrapper.style.height = "80px";

      const img = document.createElement("img");
      img.src = `img/dice${valor}.png`;
      img.alt = `Dado ${valor}`;
      img.className = "dice";

      dadoWrapper.appendChild(img);
      contenedor.appendChild(dadoWrapper);
    });
  }

  function animarDado(dadoWrapper, callback) {
    const video = document.createElement("video");
    video.src = "video/lanzar.mp4";
    video.muted = true;
    video.style.position = "absolute";
    video.style.top = "0";
    video.style.left = "0";
    video.style.width = "80px";
    video.style.height = "80px";
    video.style.zIndex = "10";

    // Recortar un 8% de cada lado horizontalmente para eliminar marcas negras
    video.style.clipPath = "inset(0 8% 0 8%)";

    dadoWrapper.appendChild(video);

    const sonido = new Audio("sounds/lanzar-dados.mp3");

    sonido.addEventListener("loadedmetadata", () => {
      if (video.readyState >= 2) {
        ajustarDuracion();
      } else {
        video.addEventListener("loadedmetadata", ajustarDuracion);
      }

      function ajustarDuracion() {
        const nuevaDuracion = sonido.duration - 0.5;
        video.playbackRate = video.duration / nuevaDuracion;
        video.play().catch(() => {});
        sonido.play().catch(() => {});
      }
    });

    video.onended = () => {
      dadoWrapper.removeChild(video);
      if (typeof callback === "function") callback();
    };
  }

  function lanzarDados() {
    const cantidad = dadosRestantes;
    const dados = Array.from({ length: cantidad }, () => Math.floor(Math.random() * 6) + 1);

    const contenedor = document.getElementById("dados");
    contenedor.style.display = "flex";
    mostrarDados(dados);

    let animacionesPendientes = cantidad;

    for (let i = 0; i < cantidad; i++) {
      const dadoWrapper = contenedor.children[i];
      animarDado(dadoWrapper, () => {
        animacionesPendientes--;
        if (animacionesPendientes === 0) {
          procesarPuntos(dados);
        }
      });
    }
  }

  function procesarPuntos(dados) {
    const { puntos, dadosUtiles } = calcularPuntos(dados);
    if (puntos === 0) {
      alert("Â¡Sin puntos! Turno perdido.");
      puntosTurno = 0;
      pasarTurno();
    } else {
      puntosTurno += puntos;
      dadosRestantes = dados.length - dadosUtiles;
      if (dadosRestantes === 0) {
        dadosRestantes = 6;
      }
      document.getElementById("puntos-turno").textContent = `Puntos en este turno: ${puntosTurno}`;
    }
  }

  function plantarse() {
    puntuaciones[turno] += puntosTurno;
    actualizarMarcadores();
    puntosTurno = 0;
    dadosRestantes = 6;
    pasarTurno();
  }

  function pasarTurno() {
    turno = (turno + 1) % jugadores;
    dadosRestantes = 6;
    mostrarTurno();
    document.getElementById("puntos-turno").textContent = "";
    document.getElementById("dados").innerHTML = "";
  }

  function actualizarMarcadores() {
    for (let i = 0; i < jugadores; i++) {
      document.getElementById(`jugador${i}`).textContent = `Jugador ${i + 1}: ${puntuaciones[i]}`;
    }
  }

  function calcularPuntos(dados) {
    let puntos = 0;
    let cuenta = {};
    dados.forEach(d => cuenta[d] = (cuenta[d] || 0) + 1);

    let dadosUtiles = 0;

    for (let i = 1; i <= 6; i++) {
      const cantidad = cuenta[i] || 0;
      if (cantidad >= 3) {
        puntos += i === 1 ? 300 : i * 100;
        dadosUtiles += 3;
        if (cantidad >= 4) { puntos += 1000; dadosUtiles += 1; }
        if (cantidad === 5) { puntos += 1000; dadosUtiles += 1; }
      }
    }

    puntos += (cuenta[1] || 0) < 3 ? (cuenta[1] || 0) * 100 : 0;
    puntos += (cuenta[5] || 0) < 3 ? (cuenta[5] || 0) * 50 : 0;
    dadosUtiles += (cuenta[1] || 0) < 3 ? (cuenta[1] || 0) : 0;
    dadosUtiles += (cuenta[5] || 0) < 3 ? (cuenta[5] || 0) : 0;

    return { puntos, dadosUtiles };
  }
</script>
</body>
</html>
